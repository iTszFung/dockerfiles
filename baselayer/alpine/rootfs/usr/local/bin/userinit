#!/usr/bin/env bash
# userinit v0.1.0 用户初始化、添加工具

. /usr/lib/functions

init() {
  USER=${USER_NAME:-itszfung}
  GROUP=${GROUP_NAME:-$USER}
  USER_ID=${USER_ID:-1000}
  GROUP_ID=${GROUP_ID:-$USER_ID}
  HOME=${USER_HOME:-/var/lib/$USER}
}

# $1 gid $2 group
_add_group() {
  addgroup -g $1 $2
}

# $1 user $2 uid $3 gid $4 home $5 shell
_add_user() {
  adduser -u $2 -G $3 -D -h $4 -s $5 -S -g 'Daemond User' $1
}

add_user() {
	_add_group $3 $4
	_add_user $1 $2 $3 $5 $6
}

user_info() {
  logs "用户 $1 基本信息："
  logs "ID：$(id -u $1)"
  logs "属组：$(id -g $1)"
  logs "附加组：$(id -G $1)"
}

# adduser -G group -S -D -s /sbin/nologin -u userId
create_user() {
  _add_group ${GROUP_ID} ${GROUP}
  adduser -s /sbin/nologin -g 'Daemon User' \
    -h ${HOME} -D -G ${GROUP} -S -u ${USER_ID} ${USER}
  logs "创建了系统用户 ${USER}"
}

if [ $# == 0 ];then
	init && create_user
elif [ $# == 1 ];then
	case "$1" in
		help)
			logs "$0 user uid gid group home shell"
			exit 0
		;;
		*)
			logs "无此参数"
		;;
	esac
elif [ $# == 2 ];then
	user_info $2
else
  add_user $1 $2 $3 $4 $5 $6
fi

